{"id":"662J","dependencies":[{"name":"/Users/hansoksendahl/Code/hox.io/packages/@hox.io/app/.babelrc","includedInParent":true,"mtime":1560383891736},{"name":"/Users/hansoksendahl/Code/hox.io/packages/@hox.io/app/package.json","includedInParent":true,"mtime":1561481613478},{"name":"../../constants","loc":{"line":1,"column":22},"parent":"/Users/hansoksendahl/Code/hox.io/packages/@hox.io/app/src/components/cards/zui/db/node/getNodes.js","resolved":"/Users/hansoksendahl/Code/hox.io/packages/@hox.io/app/src/components/cards/zui/constants.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.default=e;var t=require(\"../../constants\");async function n(t,e,a,s){const o=await t.nodes.get(e);if(s&&(o.icon=s),o&&a>0){const s=await t.links.where({from:e}).sortBy(\"ordinal\");o.links=a>1&&s.length>0?await Promise.all(s.map(async({to:e},o)=>n(t,e,a-1,s[o].icon))):s.length}return o}async function e(e,a=parseInt(localStorage.getItem(t.ROOT_ID)),s=3){return await e.transaction(\"r\",e.nodes,e.links,async()=>await n(e,a,s))}"},"sourceMaps":{"js":{"mappings":[{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":60,"column":1},"generated":{"line":1,"column":0}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":60,"column":1},"generated":{"line":1,"column":13}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":60,"column":1},"generated":{"line":1,"column":20}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":60,"column":1},"generated":{"line":1,"column":35}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":60,"column":1},"generated":{"line":1,"column":43}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":60,"column":1},"generated":{"line":1,"column":56}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":60,"column":1},"generated":{"line":1,"column":57}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":60,"column":1},"generated":{"line":1,"column":64}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":60,"column":1},"generated":{"line":1,"column":68}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":60,"column":1},"generated":{"line":1,"column":76}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":60,"column":1},"generated":{"line":1,"column":84}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":1,"column":0},"generated":{"line":1,"column":86}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":1,"column":0},"generated":{"line":1,"column":90}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":1,"column":0},"generated":{"line":1,"column":92}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":1,"column":0},"generated":{"line":1,"column":100}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":10,"column":0},"generated":{"line":1,"column":119}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"recurseNode","original":{"line":10,"column":15},"generated":{"line":1,"column":134}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"tx","original":{"line":11,"column":2},"generated":{"line":1,"column":136}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"from","original":{"line":12,"column":2},"generated":{"line":1,"column":138}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"depth","original":{"line":13,"column":2},"generated":{"line":1,"column":140}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"icon","original":{"line":14,"column":2},"generated":{"line":1,"column":142}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"node","original":{"line":16,"column":8},"generated":{"line":1,"column":145}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"node","original":{"line":16,"column":8},"generated":{"line":1,"column":151}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"tx","original":{"line":16,"column":21},"generated":{"line":1,"column":159}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"nodes","original":{"line":16,"column":24},"generated":{"line":1,"column":161}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"get","original":{"line":16,"column":30},"generated":{"line":1,"column":167}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"from","original":{"line":16,"column":34},"generated":{"line":1,"column":171}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"node","original":{"line":19,"column":6},"generated":{"line":1,"column":174}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"icon","original":{"line":17,"column":6},"generated":{"line":1,"column":177}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"node","original":{"line":17,"column":12},"generated":{"line":1,"column":181}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"icon","original":{"line":17,"column":17},"generated":{"line":1,"column":183}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"icon","original":{"line":17,"column":24},"generated":{"line":1,"column":188}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"node","original":{"line":19,"column":6},"generated":{"line":1,"column":191}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"depth","original":{"line":19,"column":14},"generated":{"line":1,"column":194}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":19,"column":22},"generated":{"line":1,"column":196}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":19,"column":25},"generated":{"line":1,"column":198}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"links","original":{"line":20,"column":10},"generated":{"line":1,"column":199}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"links","original":{"line":20,"column":10},"generated":{"line":1,"column":205}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"tx","original":{"line":20,"column":24},"generated":{"line":1,"column":213}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"links","original":{"line":20,"column":27},"generated":{"line":1,"column":215}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"where","original":{"line":20,"column":33},"generated":{"line":1,"column":221}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":20,"column":39},"generated":{"line":1,"column":227}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"from","original":{"line":20,"column":40},"generated":{"line":1,"column":228}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"from","original":{"line":20,"column":40},"generated":{"line":1,"column":233}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"sortBy","original":{"line":20,"column":47},"generated":{"line":1,"column":237}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":20,"column":54},"generated":{"line":1,"column":244}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"node","original":{"line":23,"column":6},"generated":{"line":1,"column":255}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"links","original":{"line":23,"column":11},"generated":{"line":1,"column":257}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"depth","original":{"line":22,"column":8},"generated":{"line":1,"column":263}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":22,"column":16},"generated":{"line":1,"column":265}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"links","original":{"line":23,"column":19},"generated":{"line":1,"column":268}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"length","original":{"line":23,"column":25},"generated":{"line":1,"column":270}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":23,"column":34},"generated":{"line":1,"column":277}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"Promise","original":{"line":24,"column":16},"generated":{"line":1,"column":285}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"all","original":{"line":24,"column":24},"generated":{"line":1,"column":293}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"links","original":{"line":24,"column":28},"generated":{"line":1,"column":297}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"map","original":{"line":24,"column":34},"generated":{"line":1,"column":299}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":24,"column":38},"generated":{"line":1,"column":303}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"to","original":{"line":24,"column":46},"generated":{"line":1,"column":310}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"to","original":{"line":24,"column":46},"generated":{"line":1,"column":313}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"i","original":{"line":24,"column":51},"generated":{"line":1,"column":316}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"recurseNode","original":{"line":25,"column":12},"generated":{"line":1,"column":320}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"tx","original":{"line":26,"column":14},"generated":{"line":1,"column":322}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"to","original":{"line":27,"column":14},"generated":{"line":1,"column":324}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"depth","original":{"line":28,"column":14},"generated":{"line":1,"column":326}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":28,"column":22},"generated":{"line":1,"column":328}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"links","original":{"line":29,"column":14},"generated":{"line":1,"column":330}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"i","original":{"line":29,"column":20},"generated":{"line":1,"column":332}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"icon","original":{"line":29,"column":23},"generated":{"line":1,"column":335}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"links","original":{"line":34,"column":19},"generated":{"line":1,"column":343}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"length","original":{"line":34,"column":25},"generated":{"line":1,"column":345}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"node","original":{"line":38,"column":9},"generated":{"line":1,"column":352}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"node","original":{"line":38,"column":9},"generated":{"line":1,"column":359}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":48,"column":15},"generated":{"line":1,"column":361}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"getNodes","original":{"line":48,"column":30},"generated":{"line":1,"column":376}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"tx","original":{"line":49,"column":2},"generated":{"line":1,"column":378}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"from","original":{"line":50,"column":2},"generated":{"line":1,"column":380}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"parseInt","original":{"line":50,"column":9},"generated":{"line":1,"column":382}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"localStorage","original":{"line":50,"column":18},"generated":{"line":1,"column":391}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"getItem","original":{"line":50,"column":31},"generated":{"line":1,"column":404}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"ROOT_ID","original":{"line":50,"column":39},"generated":{"line":1,"column":412}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":50,"column":18},"generated":{"line":1,"column":414}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"depth","original":{"line":51,"column":2},"generated":{"line":1,"column":424}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":51,"column":8},"generated":{"line":1,"column":426}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":53,"column":9},"generated":{"line":1,"column":429}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"tx","original":{"line":53,"column":15},"generated":{"line":1,"column":442}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"transaction","original":{"line":53,"column":18},"generated":{"line":1,"column":444}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":53,"column":30},"generated":{"line":1,"column":456}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"tx","original":{"line":53,"column":35},"generated":{"line":1,"column":460}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"nodes","original":{"line":53,"column":38},"generated":{"line":1,"column":462}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"tx","original":{"line":53,"column":45},"generated":{"line":1,"column":468}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"links","original":{"line":53,"column":48},"generated":{"line":1,"column":470}},{"source":"src/components/cards/zui/db/node/getNodes.js","original":{"line":53,"column":55},"generated":{"line":1,"column":476}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"recurseNode","original":{"line":54,"column":17},"generated":{"line":1,"column":491}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"tx","original":{"line":55,"column":6},"generated":{"line":1,"column":493}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"from","original":{"line":56,"column":6},"generated":{"line":1,"column":495}},{"source":"src/components/cards/zui/db/node/getNodes.js","name":"depth","original":{"line":57,"column":6},"generated":{"line":1,"column":497}}],"sources":{"src/components/cards/zui/db/node/getNodes.js":"import {ROOT_ID} from '../../constants';\n\n/**\n * Recurse looking up all descendents of a node to a given depth.\n * \n * @param {Dexie} tx A dexie database transaction instance\n * @param {number} from A node id\n * @param {number} depth The depth to recurse\n */\nasync function recurseNode(\n  tx,\n  from,\n  depth,\n  icon,\n) {\n  const node = await tx.nodes.get(from);\n  if (icon) node.icon = icon;\n\n  if (node && depth > 0) {\n    const links = await tx.links.where({from}).sortBy('ordinal');\n\n    if (depth > 1) {\n      node.links = links.length > 0\n        ? await Promise.all(links.map(async ({to}, i) => (\n            recurseNode(\n              tx,\n              to,\n              depth - 1,\n              links[i].icon\n            )\n          )))\n        : links.length\n    } else {\n      node.links = links.length;\n    }\n  }\n\n  return node;\n}\n\n/**\n * Set up a Dexie database transaction then recurse within the transaction.\n * \n * @param {Dexie} tx A dexie database instance\n * @param {number} from A node id\n * @param {number} depth The depth to recurse\n */\nexport default async function getNodes(\n  tx,\n  from = parseInt(localStorage.getItem(ROOT_ID)),\n  depth=3\n) {\n  return await tx.transaction('r', tx.nodes, tx.links, async () => {\n    return await recurseNode(\n      tx,\n      from,\n      depth,\n    );\n  });\n};"},"lineCount":null}},"error":null,"hash":"5ad07bbf3d8c4179c73bd99b5d20a8ee","cacheData":{"env":{}}}